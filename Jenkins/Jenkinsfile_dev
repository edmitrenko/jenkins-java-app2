pipeline{
  agent {
        docker {
            image 'maven:3-alpine'
            args '-u root -v /tmp:/tmp -v $HOME/.m2:/root/.m2'
            reuseNode true
            // executes on an executor with the label 'some-label' or 'docker'
            //label "some-label || docker"
        }
  }
  parameters { 
     string(name: 'tomcat_dev', defaultValue: '13.36.171.134', description: 'Tomcat dev')
    } 
  
  stages{
     stage("Build"){
       steps{       
	    // Run Maven on a Unix agent
            sh "./mvnw clean install"
            }
     }
      stage("Deploy"){
       steps{
          sshagent(['tomcat-server-dev']) {
          sh "scp -o StrictHostKeyChecking=no target/*.war ubuntu@${params.tomcat_dev}:/opt/tomcat/webapps/"
          }
       } 
     }     
  }  
}    